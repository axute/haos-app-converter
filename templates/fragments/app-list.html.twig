{% if repository is defined and repository is iterable %}
    <div id="repoInfo" class="mb-2 text-muted small" style="padding: 0 16px;">
        {% if repository.name is not empty %}<strong>{{ repository.name }}</strong>{% endif %}
        {% if repository.name is not empty and repository.description is not empty %} â€” {% endif %}
        {% if repository.description is not empty %}{{ repository.description }}{% endif %}
    </div>
{% endif %}

<div id="appList" class="list-group list-group-flush mb-3">
    {% if apps is empty %}
        <div class="list-group-item">No apps found</div>
    {% else %}
        {% for app in apps %}
            {% set isSelf = (app.slug == 'haos_app_converter') %}
            <div class="list-group-item">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="me-3 text-center" style="width: 40px; font-size: 24px;">
                            {% if app.has_local_icon %}
                                <img src="{{ basePath }}/apps/{{ app.slug }}/icon.png" style="width: 32px; height: 32px;" alt="{{ app.slug }}">
                            {% else %}
                                ðŸ“¦
                            {% endif %}
                        </div>
                        <div>
                            <strong>{{ app.name }}</strong>
                            {% if app.detected_pm is not empty %}
                                <span class="badge bg-info text-dark rounded-pill ms-1" style="font-size: 0.7rem;">{{ app.detected_pm }}</span>
                            {% endif %}
                            {% if app.quirks %}
                                <span class="badge bg-warning text-dark rounded-pill ms-1" style="font-size: 0.7rem;">quirks</span>
                            {% endif %}
                            <small class="text-muted d-block">{{ app.description }}</small>
                            <small class="text-muted">Version: {{ app.version }}</small>
                            <div class="mt-1 d-flex align-items-center flex-wrap">
                                <small class="text-muted">Image: <a href="{{ app.image_url }}" target="_blank" class="text-decoration-none"><code>{{ app.image }}:{{ app.image_tag }}</code></a></small>
                                <div id="update-status-{{ app.slug }}"
                                      hx-get="{{ basePath }}/fragments/check-update/{{ app.slug }}"
                                      hx-trigger="load" 
                                      hx-swap="outerHTML"
                                      hx-indicator="this"
                                      class="d-inline-block">
                                    <span class="badge bg-light text-muted rounded-pill htmx-indicator" style="font-size: 0.7rem;">
                                        <span class="mdi mdi-loading mdi-spin"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if isSelf %}
                        <span class="badge bg-secondary rounded-pill">System</span>
                    {% else %}
                        <div class="text-nowrap">
                            <div class="form-check form-switch d-inline-flex align-items-center me-2">
                                <input class="form-check-input me-1" type="checkbox" id="vf_{{ app.slug }}" {% if app.version_fixation %}checked{% endif %}
                                       onchange="toggleVersionFixation('{{ app.slug }}', this.checked)">
                                <label class="form-check-label small" for="vf_{{ app.slug }}" title="Version der App an das Docker-Image binden">Version fixieren</label>
                            </div>
{#                             <!-- next version feature -->#}
{#                            <div class="form-check form-switch d-inline-flex align-items-center me-3">#}
{#                                <input class="form-check-input me-1" type="checkbox" id="au_{{ app.slug }}" {% if app.auto_update %}checked{% endif %}#}
{#                                       onchange="toggleAutoUpdate('{{ app.slug }}', this.checked)">#}
{#                                <label class="form-check-label small" for="au_{{ app.slug }}" title="Automatische Updates aktivieren/deaktivieren">Auto-Update</label>#}
{#                            </div>#}
                            <button type="button" class="btn btn-sm btn-ha-outline rounded-pill me-1" title="Info" 
                                    hx-get="{{ basePath }}/fragments/app-details/{{ app.slug }}"
                                    hx-target="#app-info-{{ app.slug }}"
                                    onclick="bootstrap.Collapse.getOrCreateInstance(document.getElementById('app-info-{{ app.slug }}')).toggle()">
                                <span class="mdi mdi-information-outline"></span>
                            </button>
                            <button type="button" class="btn btn-sm btn-ha-outline rounded-pill me-1" onclick="editApp('{{ app.slug }}')">
                                <span class="mdi mdi-pencil"></span>
                            </button>
                            <button type="button" class="btn btn-sm btn-ha-outline rounded-pill text-danger border-danger" onclick="deleteApp('{{ app.slug }}')">
                                <span class="mdi mdi-delete"></span>
                            </button>
                        </div>
                    {% endif %}
                </div>
                <div id="app-info-{{ app.slug }}" class="collapse mt-3"></div>
            </div>
        {% endfor %}
    {% endif %}
</div>
